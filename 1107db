-- 회원
CREATE TABLE MEMBER(
    USERID VARCHAR2(15) PRIMARY KEY,
    PASSWORD VARCHAR2(500) NOT NULL,
    NAME VARCHAR2(20) NOT NULL,
    GENDER CHAR(1) CHECK( GENDER IN ('M','F')),
    BIRTH DATE NOT NULL,
    EMAIL VARCHAR2(30) NOT NULL,
    PHONE VARCHAR2(14) NOT NULL,
    ADDRESS VARCHAR2(100) NOT NULL,
    ENROLLDATE DATE DEFAULT SYSDATE
);

-- 주문
CREATE TABLE ORDERLT(
    ORDERNUM NUMBER PRIMARY KEY,                  -- 주문 번호
    USERID VARCHAR2(15) NOT NULL,                 -- 회원 ID
    ORDERDATE DATE DEFAULT SYSDATE,               -- 주문 일자
    PRICE NUMBER NOT NULL,                        -- 주문 총액
    USERADDRESS VARCHAR2(500) NOT NULL,           -- 회원 주소
    PRICECK CHAR(1)CHECK( PRICECK IN ('Y', 'N')), -- 입금 여부
    TRACKING_NUM NUMBER UNIQUE,                   -- 송장번호
    CONSTRAINT USER_TABLE_USERID_FK FOREIGN KEY(USERID) REFERENCES MEMBER (USERID)  
);

-- 공지 사항
CREATE TABLE NOTICE(
     NNO NUMBER PRIMARY KEY,                                 --공지번호/프라이머리키 지정
     USERID VARCHAR2(15) NOT NULL,       -- 회원 ID
     NTITLE VARCHAR2(100) NOT NULL,                          -- 공지제목
     NCONTENT VARCHAR2(4000) NOT NULL,                  -- 공지내용 
     NCOUNT NUMBER DEFAULT 0,                                -- 조회수
     NDATE DATE DEFAULT SYSDATE                             -- 작성일    
     FOREIGN KEY (USERID) REFERENCES MEMBER(USERID)
);

CREATE SEQUENCE SEQ_NNO; -- 공지번호 시퀀스

-- 이벤트
CREATE TABLE EVENT(
    EVENTALLNO NUMBER PRIMARY KEY,      -- 전체 글번호
    ETYPE NUMBER(1) NOT NULL,           -- 게시판 타입 : 1/이벤트게시판, 2/당첨자 발표
    ENO NUMBER,                         -- 타입별 글번호
    USERID VARCHAR2(15) NOT NULL,       -- 회원 ID
    EVTDATE DATE DEFAULT SYSDATE,       -- 이벤트 시작일자
    EVTDATEEND DATE,                    -- 이벤트 종료일자
    EVTCONTENT VARCHAR2(1000) NOT NULL, -- 내용
    EVTTITLE VARCHAR2(100) NOT NULL,    -- 제목
    E_FILE VARCHAR2(2000),
    CONSTRAINT UN_ENO UNIQUE (ETYPE, ENO) -- 1번 게시판에는 1번이 1개만 있는 유니크 조건
);

-- 당첨자
CREATE TABLE EVENTWINNER(
    EVENTALLNO NUMBER,
    WINNERID VARCHAR2(15),
    NAME VARCHAR2(20) NOT NULL,
    FOREIGN KEY (WINNERID) REFERENCES MEMBER(USERID),
    FOREIGN KEY (EVENTALLNO) REFERENCES EVENT(EVENTALLNO),
    CONSTRAINT EVENTWINNER_PK PRIMARY KEY (EVENTALLNO, WINNERID)
);


-- 이벤트 용 시퀀스
CREATE SEQUENCE SEQ_EID; -- 총 게시판 번호
CREATE SEQUENCE SEQ_ENO1; -- 이벤트 게시판용 시퀀스
CREATE SEQUENCE SEQ_ENO2; -- 당첨자발표 게시판용 시퀀스

-- 상품
CREATE TABLE PRODUCT(
    P_NO VARCHAR2(30) PRIMARY KEY,            -- 상품코드
    K_NO VARCHAR2(100) NOT NULL,               -- 종류코드
    P_NAME VARCHAR2(100) NOT NULL,      -- 상품명
    P_PRICE NUMBER NOT NULL,            -- 상품가격
    P_INGD VARCHAR2(500) NOT NULL,      -- 상품성분
    BRAND VARCHAR2(150) NOT NULL,       -- 브랜드
    P_CAP VARCHAR(100) NOT NULL,        -- 용량
    RANK NUMBER DEFAULT 0,              -- 별점
    COUNT NUMBER DEFAULT 0,              -- 재고
    P_IMG VARCHAR2(2000)               -- 상품 IMG
    O_NAME VARCHAR2(300)		-- 원본파일명
    C_NAME VARCHAR2(300)		-- 변경파일명
);

-- 테마
CREATE TABLE THEMA (
    TNO NUMBER PRIMARY KEY,                 -- 테마코드
    USERID VARCHAR2(15) NOT NULL,       -- 작성자 ID
    TTITLE VARCHAR2(1000) NOT NULL, -- 테마제목
    TCONTENT VARCHAR2(4000) NOT NULL,   -- 테마설명
    TIMAGE VARCHAR2(2000)             -- 테마 이미지
    );

-- 테마별 상품
CREATE TABLE THEMAPRODUCT(
    TNO NUMBER, -- 테마코드
    P_NO VARCHAR2(30), -- 상품코드
    FOREIGN KEY (TNO) REFERENCES THEMA(TNO),
    FOREIGN KEY (P_NO) REFERENCES PRODUCT(P_NO),
    CONSTRAINT THEMAPRODUCTPK PRIMARY KEY (TNO,P_NO)
);


-- 고객센터
CREATE TABLE CUSTOMER_SERVICE (
    CNO NUMBER PRIMARY KEY,         -- 글번호
    CTITLE VARCHAR2(100) NOT NULL,  -- 제목
    USERID VARCHAR2(15) NOT NULL,       -- 작성자 ID
    CCONTENT VARCHAR2(4000) NOT NULL,   -- 내용
    CDATE DATE DEFAULT SYSDATE          -- 작성일
);

CREATE SEQUENCE SEQ_CNO; -- 고객센터 글번호 시퀀스

-- 찜
CREATE TABLE WISHLIST(
   P_NO VARCHAR2(30), -- 상품코드
   USERID VARCHAR2(15), -- 회원 ID
   FOREIGN KEY (P_NO) REFERENCES PRODUCT(P_NO),
   FOREIGN KEY (USERID) REFERENCES MEMBER(USERID),
   CONSTRAINT WISHLIST_PK PRIMARY KEY (USERID,P_NO)
);

-- 리뷰
CREATE TABLE REVIEW(
    P_NO VARCHAR2(30), -- 상품코드
    USERID VARCHAR2(15), -- 회원 ID
    R_CONTENT VARCHAR(1000), -- 내용
    R_DATE DATE DEFAULT SYSDATE, -- 작성일
    R_RANK NUMBER DEFAULT 1,
    FOREIGN KEY (USERID) REFERENCES MEMBER(USERID),
    FOREIGN KEY (P_NO) REFERENCES PRODUCT(P_NO),
    CONSTRAINT REWIEW_PK PRIMARY KEY (USERID,P_NO)
);


-- 밑에는 수정코드 

-- 공지사항 작성자와 멤버 id 연결 1107
--ALTER TABLE NOTICE ADD FOREIGN KEY (USERID) REFERENCES MEMBER(USERID);

-- 상품테이블 종류코드 변경 1107
--ALTER TABLE PRODUCT MODIFY (K_NO VARCHAR2(100));

-- 상품테이블 컬럼 추가 1107
--ALTER TABLE PRODUCT ADD (O_NAME VARCHAR2(300)); -- 원본파일명
--ALTER TABLE PRODUCT ADD (C_NAME VARCHAR2(300)); -- 변경파일명
